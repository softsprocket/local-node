function InputValueRequired(e,s){this.selectors=e,this.response=s,this.orig_color={};for(each in this.selectors){var o=this.selectors[each];this.orig_color[o]=$(o).css("color")}}function Register(e){this.login=e}function Login(){this.name}function Cookies(){var e=document.cookie;console.log(e);var s=e.split(";");for(each in s){var o=s[each].split("=");this[o[0]]=o[1]}}InputValueRequired.prototype.test_required=function(e){var s=!0;e||(e=this.selectors);for(each in e){var o=e[each];""==$(o).val()&&(s=!1,$(o).css("color","red"),$(o).val("required"),$(o).focus(function(e){$(e).css("color",this.orig_color[e]),$(e).val(""),$(e).unbind("focus")}.bind(this,o)))}return s||$(this.response).text("Error: All fields are required"),s},InputValueRequired.prototype.test_equal=function(e){var s=!0;e||(e=this.selectors);var o;for(each in e){var r=e[each],n=$(r).val();o?o!=n&&(s=!1):o=n}if(!s){$(this.response).text("Error: Field values are not equal");for(each in e){var r=e[each];$(r).css("color","red"),$(r).focus(function(e){for(each in e){var s=e[each];$(s).css("color",this.orig_color[s]),$(s).unbind("focus")}}.bind(this,e))}}return s};var set_login_callback=$.Callbacks();Register.prototype.listeners=function(e){var s=this;set_login_callback.add(function(s){s?($(e.register).hide(),$(e.menu).hide()):$(e.menu).show()});var o=new InputValueRequired([e.name,e.password,e.email,e.confirm_password],e.response);$(e.menu).click(function(){return"none"==$(e.register).css("display")?$(e.register).show():$(e.register).hide(),!1}),$(e.register).submit(function(r){if(r.preventDefault(),o.test_required()&&o.test_equal([e.password,e.confirm_password])){var n={name:$(e.name).val(),password:$(e.password).val(),email:$(e.email).val()};console.log("send_data",n),$.ajax({type:"POST",url:"/login",data:n,dataType:"json",encode:!0}).done(function(e){console.log(e),s.login.name=e.name,set_login_callback.fire(!0)}).fail(function(s){$(e.response).text(403==s.status?"User "+n.name+" already exists":"!"+s.status+" "+s.statusText)})}})},Login.prototype.listeners=function(e){var s=this;set_login_callback.add(function(s){s?($(e.login).hide(),$(e.menu).text("logout")):($(e.logout).hide(),$(e.menu).text("login"))});var o=new InputValueRequired([e.name,e.password],e.response);$(e.menu).click(function(){return"login"==$(e.menu).text()?"none"==$(e.login).css("display")?$(e.login).show():$(e.login).hide():$(e.logout).show(),!1}),$(e.login).submit(function(r){if(r.preventDefault(),o.test_required()){var n={name:$(e.name).val(),password:$(e.password).val()};$.ajax({type:"PUT",url:"/login",data:n,dataType:"json",encode:!0}).done(function(e){console.log(e),s.name=e.name,set_login_callback.fire(!0)}).fail(function(s){$(e.response).text(404==s.status?"User "+n.name+" "+s.statusText:s.status+" "+s.statusText)})}}),$(e.logout).submit(function(s){s.preventDefault(),$.ajax({type:"GET",url:"login"}).done(function(){console.log("logout ok"),set_login_callback.fire(!1)}).fail(function(s){$(e.response).text(s.status+" "+s.statusText)})})};var user_login=new Login,user_register=new Register(user_login);$(function(){var e={menu:"#login_nav",login:"#user_login",logout:"#user_logout",name:"#user_name",password:"#user_password",response:"#user_login_resp"};user_login.listeners(e);var s={menu:"#register_nav",register:"#user_register",name:"#user_reg_name",password:"#user_reg_password",confirm_password:"#user_reg_confirm_password",email:"#user_reg_email",response:"#user_register_resp"};user_register.listeners(s)});